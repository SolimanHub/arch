#!/usr/bin/env bash
set -euo pipefail

# Configurar colores
RED='\033[31m'
GREEN='\033[32m'
YELLOW='\033[33m'
NC='\033[0m'

# Función para salir ante errores
error_exit() {
    echo -e "\033[31m[ERROR] $1\033[0m" >&2
    exit 1
}

# Solicitar información
echo -e "${GREEN}== Configuración de instalación de Arch Linux ==${NC}"


echo -e "\033[32m===== Selección de entornos gráficos =====\033[0m"
echo -e "\033[32m1) i3wm (Default)\033[0m"
echo -e "\033[32m2) XFCE4\033[0m"
echo -e "\033[32m3) GNOME\033[0m"
echo -e "\033[32m4) KDE Plasma\033[0m"
echo -e "\033[32m5) Hyprland (Wayland moderno)\033[0m"
echo -e "\033[32m6) GNOME Minimal\033[0m"
echo -e "\033[32m7) Sway (i3 en Wayland)\033[0m"
echo -e "\033[32m8) MATE (Clásico ligero)\033[0m"

valid_desktops="1 2 3 4 5 6 7 8"
while true; do
    read -rp "Opciones (separar por comas) [Default: 1]: " desktop_choices
    
    # Limpiar espacios y establecer default si está vacío
    desktop_choices=$(echo "$desktop_choices" | xargs)  # Eliminar espacios sobrantes
    desktop_choices=${desktop_choices:-1}  # Establecer 1 si está vacío
    
    # Convertir a array y validar cada opción
    invalid=0
    IFS=',' read -ra choices <<< "$desktop_choices"
    
    for choice in "${choices[@]}"; do
        choice_clean=$(echo "$choice" | tr -d '[:space:]')
        if ! [[ "$choice_clean" =~ ^[1-8]$ ]]; then
            echo -e "${RED}Opción inválida: $choice_clean. Solo números del 1 al 8 permitidos.${NC}"
            invalid=1
            break
        fi
    done
    
    [ $invalid -eq 0 ] && break
done

sed -i "s/escritorioxyz/$desktop_choices/g" extras

./extras
