#!/usr/bin/env bash
set -euo pipefail

echo "Seleccione su procesador para instalar el microcódigo adecuado:"
echo "1) Intel"
echo "2) AMD"
read -rp "Opción [1/2]: " proc_choice

microcode=""
if [ "$proc_choice" = "1" ]; then
    microcode="intel-ucode"
elif [ "$proc_choice" = "2" ]; then
    microcode="amd-ucode"
else
    echo "Opción no válida, no se instalará microcódigo."
fi

# ===== Selección de kernel =====
select_kernel() {
    echo "===== Selección de Kernel ====="
    echo "1) Linux Standard (default)"
    echo "2) Linux-Zen (mejor para escritorio)"
    echo "3) Linux-LTS (larga vida útil)"
    echo "4) Todos los kernels anteriores"
    read -rp "Seleccione kernel [1-4]: " kernel_choice
    
    case "$kernel_choice" in
        2) kernels="linux-zen linux-zen-headers" ;;
        3) kernels="linux-lts linux-lts-headers" ;;
        4) kernels="linux linux-headers linux-zen linux-zen-headers linux-lts linux-lts-headers" ;;
        *) kernels="linux linux-headers" ;;
    esac
}

pacstrap /mnt base efibootmgr gvfs gvfs-afc gvfs-mtp $kernels \
           wpa_supplicant dialog xf86-input-synaptics networkmanager neovim htop $microcode

genfstab -pU /mnt >> /mnt/etc/fstab

./pre-conf

