#!/usr/bin/env bash
set -euo pipefail

# --- Selección de microcódigo ---
echo "Seleccione su procesador para instalar el microcódigo adecuado:"
echo "<<==============================>>"
echo "1) Intel"
echo "2) AMD"
read -rp "Opción [1/2]: " proc_choice

microcode=""
case "$proc_choice" in
    1) microcode="intel-ucode" ;;
    2) microcode="amd-ucode" ;;
    *) echo "Opción no válida, no se instalará microcódigo." ;;
esac

# --- Selección de kernel ---
select_kernel() {
    echo "===== Selección de Kernel ====="
    echo "1) Linux Standard (default)"
    echo "2) Linux-Zen (mejor para escritorio)"
    echo "3) Linux-LTS (larga vida útil)"
    echo "4) Todos los kernels anteriores"
    read -rp "Seleccione kernel [1-4]: " kernel_choice
    
    local kernels=""
    case "$kernel_choice" in
        2) kernels="linux-zen linux-zen-headers" ;;
        3) kernels="linux-lts linux-lts-headers" ;;
        4) kernels="linux linux-headers linux-zen linux-zen-headers linux-lts linux-lts-headers" ;;
        *) kernels="linux linux-headers" ;;
    esac
    
    echo "$kernels"
}

# --- Instalación base ---
kernel_packages=$(select_kernel)
pacstrap /mnt base $microcode linux-firmware $kernel_packages

# --- Generar fstab ---
genfstab -U /mnt >> /mnt/etc/fstab

# --- Continuar configuración ---
echo "Ejecutando pre-conf..."
echo "<<==============================>>"
./pre-conf
